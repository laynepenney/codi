# PR Review Workflow
# This workflow performs comprehensive PR review using multiple AI models with different strengths
name: pr-review
description: Comprehensive pull request review process using multiple AI models

steps:
  # Step 1: Analyze PR changes with fast model (Haiku)
  - id: analyze-pr-changes
    action: ai-prompt
    description: "Quick PR analysis with Haiku model"
    prompt: |
      Analyze this pull request by examining:
      
      1. Files changed and the scope of modifications
      2. Architecture implications - how changes affect code structure
      3. Potential risk areas - what could break
      4. Dependencies affected - any library updates or new imports
      5. Testing completeness - are all changes covered by tests?
      
      Focus on high-level impact assessment and provide a quick overview of the PR's scope.
    model: "claude-3-5-haiku-latest"

  # Step 2: Switch to detailed analysis model
  - id: switch-to-detailed-analysis
    action: switch-model
    description: "Switch to Sonnet for detailed code review"
    model: "claude-sonnet-4-20250514"

  # Step 3: In-depth code review
  - id: detailed-code-review
    action: ai-prompt
    description: "Detailed code analysis with Sonnet model"
    prompt: |
      Perform comprehensive code review focusing on:
      
      ## Technical Quality
      - Code quality and maintainability
      - Error handling and edge case coverage
      - Performance implications
      - Security considerations
      
      ## Architecture & Design
      - Architectural patterns used
      - Design decisions and their impact
      - Consistency with existing codebase
      - Follows project conventions
      
      ## Testing
      - Test coverage adequacy
      - Test quality and reliability
      - New test cases needed
      - Edge case testing coverage
      
      Provide specific, actionable feedback.

  # Step 4: Get alternative perspective with GPT model
  - id: switch-to-alternative-perspective
    action: switch-model
    description: "Switch to GPT for different perspective"
    model: "gpt-4o"

  # Step 5: Alternative perspective review
  - id: alternative-review
    action: ai-prompt
    description: "Alternative perspective review with GPT model"
    prompt: |
      Review the PR from a different angle:
      
      ## Modern Practices
      - Are modern development practices followed?
      - Could newer patterns improve this code?
      - Are there more efficient alternatives?
      
      ## User Experience
      - How do changes affect end users?
      - Any potential UX improvements?
      - Documentation adequacy
      
      ## System Impact
      - Integration with other components
      - Scalability considerations
      - Monitoring and observability

  # Step 6: Switch to synthesis model
  - id: switch-to-synthesis
    action: switch-model
    description: "Switch to Ollama for synthesis"
    model: "llama3.2"

  # Step 7: Synthesize all reviews into actionable items
  - id: synthesize-review
    action: ai-prompt
    description: "Synthesize all reviews into actionable items"
    prompt: |
      Synthesize all previous reviews into a comprehensive PR review:
      
      ## Critical Issues (Must Fix Before Merge)
      - List critical security, performance, or stability issues
      
      ## Important Improvements (Should Fix)
      - Code quality improvements
      - Testing gaps
      - Documentation needs
      
      ## Nice-to-Have Enhancements
      - Optional improvements
      - Future optimization opportunities
      
      ## Approval Status
      - Does this PR meet minimum standards?
      - Any blocking issues?
      - Suggested follow-up actions

  # Step 8: Generate comprehensive review summary
  - id: generate-review-summary
    action: ai-prompt
    description: "Generate final PR review summary"
    prompt: |
      Create a final PR review summary formatted for GitHub:
      
      ## Summary
      Brief overview of changes and review outcome
      
      ## Changes Reviewed
      - List key changes with status
      
      ## Recommendations
      - Specific code changes suggested
      - Testing requirements
      - Follow-up actions
      
      ## Approval Status
      - Clear approve/request changes decision
      - Justification for decision
      
      Format the response as proper GitHub PR review format.
